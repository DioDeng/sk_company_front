"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[322],{5044:function(t,e,a){a.d(e,{B1:function(){return r},Ck:function(){return c},IP:function(){return b},Jh:function(){return p},LW:function(){return k},Mu:function(){return d},Mz:function(){return y},RJ:function(){return _},TA:function(){return f},Vh:function(){return g},WA:function(){return w},fy:function(){return h},i3:function(){return n},mL:function(){return s},nx:function(){return i},rO:function(){return m},yb:function(){return u}});var o=a(1076);const l="https://skcompoany.zeabur.app",s=()=>o.Z.get(`${l}/admin/workers`),i=t=>o.Z.post(`${l}/admin/worker`,t),n=t=>o.Z.patch(`${l}/admin/worker`,t),d=t=>o.Z.delete(`${l}/admin/worker/${t}`),r=t=>o.Z.get(`${l}/admin/workerList/${t}`),m=()=>o.Z.get(`${l}/admin/companys`),u=t=>o.Z.post(`${l}/admin/company`,t),c=t=>o.Z.patch(`${l}/admin/company`,t),p=t=>o.Z.delete(`${l}/admin/company/${t}`),h=t=>o.Z.get(`${l}/admin/cooperateList/${t}`),_=t=>o.Z.get(`${l}/admin/orders`,{params:t}),b=t=>o.Z.get(`${l}/admin/order/${t}`),g=t=>o.Z.post(`${l}/admin/order`,t),f=t=>o.Z.patch(`${l}/admin/orderStatus`,t),w=t=>o.Z.patch(`${l}/admin/order`,t),k=t=>o.Z.delete(`${l}/admin/order/${t}`),y=t=>o.Z.post(`${l}/admin/sign_in`,t)},8769:function(t,e,a){a.d(e,{LP:function(){return o},qz:function(){return l}});const o=()=>{const t=document.cookie.replace(/(?:(?:^|.*;\s*)admin\s*=\s*([^;]*).*$)|^.*$/,"$1");return t},l=()=>{document.cookie="admin=;expires=;path=/"}},322:function(t,e,a){a.r(e),a.d(e,{default:function(){return jt}});var o=a(3396),l=a(7139);const s={class:"py-4"},i={class:"mb-3 d-flex justify-content-between"},n=(0,o._)("ul",{class:"list-unstyled"},[(0,o._)("li",{class:"nav-item dropdown"},[(0,o._)("a",{class:"nav-link dropdown-toggle",href:"#",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," 篩選 "),(0,o._)("ul",{class:"dropdown-menu"},[(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#"},"Action")]),(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#"},"Another action")]),(0,o._)("li",null,[(0,o._)("hr",{class:"dropdown-divider"})]),(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#"},"Something else here")])])])],-1),d={class:"table table-striped table-hover"},r=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",{scope:"col"},"#"),(0,o._)("th",{scope:"col"},"姓名"),(0,o._)("th",{scope:"col"},"電話"),(0,o._)("th",{scope:"col"},"身份證"),(0,o._)("th",{scope:"col"},"年資"),(0,o._)("th",{scope:"col"},"職別"),(0,o._)("th",{scope:"col"},"工作記錄"),(0,o._)("th",{scope:"col"},"修改")])],-1),m={scope:"row"},u=["onClick"],c=["onClick"],p=(0,o._)("i",{class:"bi bi-journal-text"},null,-1),h=[p],_=["onClick"],b=(0,o._)("i",{class:"bi bi-pencil"},null,-1),g=[b];function f(t,e,a,p,b,f){const w=(0,o.up)("IdCardModal"),k=(0,o.up)("WorkRecordModal"),y=(0,o.up)("AddEditModal");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("section",s,[(0,o._)("div",i,[n,(0,o._)("button",{class:"btn btn-dark",onClick:e[0]||(e[0]=t=>this.$emitter.emit("addEdit",{status:!0}))}," 新增員工 ")]),(0,o._)("table",d,[r,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(b.workerList,((t,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e},[(0,o._)("th",m,(0,l.zw)(e+1),1),(0,o._)("td",null,(0,l.zw)(t.name),1),(0,o._)("td",null,(0,l.zw)(t.phone),1),(0,o._)("td",null,[(0,o._)("button",{type:"button",onClick:e=>this.$refs.idModal.showModal(t),class:"btn btn-outline-dark"},(0,l.zw)(t.idNumber),9,u)]),(0,o._)("td",null,(0,l.zw)(t.seniority),1),(0,o._)("td",null,(0,l.zw)(t.position),1),(0,o._)("td",null,[(0,o._)("button",{class:"btn btn-dark",onClick:e=>this.$emitter.emit("workerList",t._id)},h,8,c)]),(0,o._)("td",null,[(0,o._)("button",{class:"btn btn-success",onClick:e=>this.$emitter.emit("addEdit",{status:!1,data:t})},g,8,_)])])))),128))])])]),(0,o.Wm)(w,{ref:"idModal"},null,512),(0,o.Wm)(k),(0,o.Wm)(y)],64)}a(560);var w=a(5044);const k={class:"modal fade",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"idCardModal"},y={class:"modal-dialog"},$={class:"modal-content"},v={class:"modal-header"},D={class:"modal-title fs-5",id:"exampleModalLabel"},M=(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),x={class:"modal-body"},S=["src"];function W(t,e,a,s,i,n){return(0,o.wg)(),(0,o.iD)("div",k,[(0,o._)("div",y,[(0,o._)("div",$,[(0,o._)("div",v,[(0,o._)("h1",D,(0,l.zw)(i.tempData.idNumber),1),M]),(0,o._)("div",x,[(0,o._)("img",{src:i.tempData.imageFront,alt:""},null,8,S)])])])],512)}var C=a(2166),L={data(){return{modal:"",tempData:""}},methods:{showModal(t){this.tempData=t,this.modal.show()}},mounted(){this.modal=new C.u_(this.$refs.idCardModal)}},V=a(89);const Z=(0,V.Z)(L,[["render",W]]);var O=Z,z=a(9242);const E={class:"modal fade",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"workRecordModal"},U={class:"modal-dialog modal-fullscreen-xl-down"},A={class:"modal-content"},I=(0,o._)("div",{class:"modal-header"},[(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),P={class:"modal-body"},N={class:"table table-striped"},R=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",{scope:"col"},"#"),(0,o._)("th",{scope:"col"},"工程名稱"),(0,o._)("th",{scope:"col"},"日期"),(0,o._)("th",{scope:"col"},"時數")])],-1),F={scope:"row"},B=["onClick"],q=(0,o._)("td",{colspan:"3"},"總累積時數：",-1),J={key:0},j={class:"row g-3"},H={class:"col-md-6"},T=(0,o._)("label",{for:"inputEmail4",class:"form-label"},"廠商名稱",-1),Y={class:"col-md-6"},G=(0,o._)("label",{for:"inputPassword4",class:"form-label"},"負責人",-1),K={class:"col-12"},Q=(0,o._)("label",{for:"inputAddress",class:"form-label"},"施工地址",-1),X={class:"col-md-6"},tt=(0,o._)("label",{for:"inputAddress2",class:"form-label"},"工程日期",-1),et={class:"col-md-6"},at={key:0},ot={key:1};function lt(t,e,a,s,i,n){return(0,o.wg)(),(0,o.iD)("div",E,[(0,o._)("div",U,[(0,o._)("div",A,[I,(0,o._)("div",P,[(0,o._)("table",N,[R,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.tempData,((t,e)=>((0,o.wg)(),(0,o.iD)("tr",{key:e},[(0,o._)("th",F,(0,l.zw)(e+1),1),(0,o._)("td",null,[(0,o._)("button",{class:"btn btn-dark",onClick:e=>n.getOrder(t._id)},(0,l.zw)(t._id),9,B)]),(0,o._)("td",null,(0,l.zw)(t.constructionDate),1),(0,o._)("td",null,(0,l.zw)(t.time),1)])))),128)),(0,o._)("tr",null,[q,(0,o._)("td",null,(0,l.zw)(i.times),1)])])]),i.tempOrder?((0,o.wg)(),(0,o.iD)("div",J,[(0,o._)("form",j,[(0,o._)("div",H,[T,(0,o.wy)((0,o._)("input",{type:"text",class:"form-control",id:"inputEmail4",disabled:"","onUpdate:modelValue":e[0]||(e[0]=t=>i.tempOrder.company.companyName=t)},null,512),[[z.nr,i.tempOrder.company.companyName]])]),(0,o._)("div",Y,[G,(0,o.wy)((0,o._)("input",{type:"text",class:"form-control",id:"inputPassword4","onUpdate:modelValue":e[1]||(e[1]=t=>i.tempOrder.company.name=t),disabled:""},null,512),[[z.nr,i.tempOrder.company.name]])]),(0,o._)("div",K,[Q,(0,o.wy)((0,o._)("input",{type:"text",class:"form-control",id:"inputAddress","onUpdate:modelValue":e[2]||(e[2]=t=>i.tempOrder.address=t),disabled:""},null,512),[[z.nr,i.tempOrder.address]])]),(0,o._)("div",X,[tt,(0,o.wy)((0,o._)("input",{type:"text",class:"form-control",id:"inputAddress2",disabled:"","onUpdate:modelValue":e[3]||(e[3]=t=>i.tempOrder.constructionDate=t)},null,512),[[z.nr,i.tempOrder.constructionDate]])]),(0,o._)("div",et,[(0,o._)("button",{class:(0,l.C_)(["btn",[i.tempOrder.status?"btn-outline-success":"btn-outline-danger"]]),disabled:""},[i.tempOrder.status?((0,o.wg)(),(0,o.iD)("span",at,"完工")):((0,o.wg)(),(0,o.iD)("span",ot,"未完工"))],2)])])])):(0,o.kq)("",!0)])])])],512)}var st={data(){return{modal:"",tempData:"",times:0,tempOrder:""}},methods:{getOrder(t){this.$emitter.emit("loadingStatus",!0),(0,w.IP)(t).then((t=>{this.$emitter.emit("loadingStatus",!1),this.tempOrder=t.data.data})).catch((t=>{console.log(t),this.$emitter.emit("loadingStatus",!1)}))},getWorkerList(t){this.$emitter.emit("loadingStatus",!0),(0,w.B1)(t).then((t=>{this.tempData=t.data.data,this.$emitter.emit("loadingStatus",!1),this.totalTime()})).catch((t=>{console.log(t),this.$emitter.emit("loadingStatus",!0)}))},totalTime(){this.times=0,this.tempData.forEach((t=>{this.times+=t.time}))},showModal(){this.modal.show()}},mounted(){this.modal=new C.u_(this.$refs.workRecordModal),this.$emitter.on("workerList",(t=>{this.tempOrder="",this.getWorkerList(t),this.showModal()}))}};const it=(0,V.Z)(st,[["render",lt]]);var nt=it;const dt={class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"AddEdit"},rt={class:"modal-dialog"},mt={class:"modal-content"},ut={class:"modal-header"},ct={class:"modal-title fs-5",id:"exampleModalLabel"},pt={key:0},ht={key:1},_t={class:"modal-body"},bt={class:"form-floating mb-3"},gt={for:"floatingInput"},ft={class:"form-floating mb-3"},wt={for:"phone"},kt={class:"form-floating mb-3"},yt={for:"floatingInput"},$t={class:"input-group mb-3"},vt=(0,o._)("label",{for:"imageFront",class:"input-group-text"},"上傳身分證或居留證正面",-1),Dt=(0,o._)("div",{class:"input-group mb-3"},[(0,o._)("input",{type:"file",class:"form-control",accept:"image/*",id:"imageBack",name:"image"}),(0,o._)("label",{for:"imageBack",class:"input-group-text"},"上傳身分證或居留證反面")],-1),Mt={class:"input-group mb-3"},xt=(0,o._)("label",{class:"input-group-text",for:"inputGroupSelect01"},"員工職別",-1),St=(0,o._)("option",{value:"工人",selected:""},"工人",-1),Wt=(0,o._)("option",{value:"監工"},"監工",-1),Ct=(0,o._)("option",{value:"工地主任"},"工地主任",-1),Lt=(0,o._)("option",{value:"工頭"},"工頭",-1),Vt=[St,Wt,Ct,Lt],Zt={class:"input-group mb-3"},Ot=(0,o._)("label",{for:"date",class:"input-group-text"},"入職日期",-1),zt={class:"form-floating mb-3"},Et={for:"floatingInput"},Ut={class:"modal-footer justify-content-between"},At=(0,o._)("div",null,null,-1),It=["disabled"];function Pt(t,e,a,s,i,n){const d=(0,o.up)("VField"),r=(0,o.up)("ErrorMessage"),m=(0,o.up)("error-message"),u=(0,o.up)("VForm");return(0,o.wg)(),(0,o.iD)("div",dt,[(0,o._)("div",rt,[(0,o._)("div",mt,[(0,o._)("div",ut,[(0,o._)("h1",ct,[i.status?((0,o.wg)(),(0,o.iD)("span",pt,"新增員工")):((0,o.wg)(),(0,o.iD)("span",ht,"修改員工"))]),(0,o._)("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...t)=>n.hideModal&&n.hideModal(...t)),"aria-label":"Close"})]),(0,o.Wm)(u,{ref:"formRefSignin",id:"profileForm",onSubmit:n.addEditWorker},{default:(0,o.w5)((({errors:a,meta:s})=>[(0,o._)("div",_t,[(0,o._)("div",bt,[(0,o.Wm)(d,{name:"姓名",type:"text",rules:"required",class:"form-control",modelValue:i.tempData.name,"onUpdate:modelValue":e[1]||(e[1]=t=>i.tempData.name=t)},null,8,["modelValue"]),(0,o._)("label",gt,[(0,o.Uk)("員工姓名 "),(0,o.Wm)(r,{name:"姓名",class:"text-danger ms-3"})])]),(0,o._)("div",ft,[(0,o.Wm)(d,{id:"phone",name:"phone",type:"text",class:(0,l.C_)(["form-control",{"is-invalid":a["電話"]}]),rules:n.isPhone,modelValue:i.tempData.phone,"onUpdate:modelValue":e[2]||(e[2]=t=>i.tempData.phone=t)},null,8,["class","rules","modelValue"]),(0,o._)("label",wt,[(0,o.Uk)("phone"),(0,o.Wm)(m,{name:"phone",class:"text-danger ms-3"})])]),(0,o._)("div",kt,[(0,o.Wm)(d,{name:"身分證字號或居留證",class:"form-control",type:"text",rules:"required|min:10",modelValue:i.tempData.idNumber,"onUpdate:modelValue":e[3]||(e[3]=t=>i.tempData.idNumber=t)},null,8,["modelValue"]),(0,o._)("label",yt,[(0,o.Uk)("身分證字號或居留證 "),(0,o.Wm)(r,{name:"身分證字號或居留證",class:"ms-3 text-danger"})])]),(0,o._)("div",$t,[(0,o._)("input",{class:"form-control",type:"file",accept:"image/*",id:"imageFront",name:"image",onChange:e[4]||(e[4]=(...e)=>t.uploadImage&&t.uploadImage(...e))},null,32),vt]),Dt,(0,o._)("div",Mt,[xt,(0,o.wy)((0,o._)("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":e[5]||(e[5]=t=>i.tempData.position=t)},Vt,512),[[z.bM,i.tempData.position]])]),(0,o._)("div",Zt,[Ot,(0,o.wy)((0,o._)("input",{id:"date",name:"date",type:"date",placeholder:"Enter email",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=t=>i.tempData.seniority=t)},null,512),[[z.nr,i.tempData.seniority]])]),(0,o._)("div",zt,[(0,o.Wm)(d,{name:"時薪",type:"text",modelValue:i.tempData.hourlyRate,"onUpdate:modelValue":e[7]||(e[7]=t=>i.tempData.hourlyRate=t),rules:"numeric",class:"form-control"},null,8,["modelValue"]),(0,o._)("label",Et,[(0,o.Uk)("時薪 "),(0,o.Wm)(r,{name:"時薪",class:"text-danger ms-3"})])])]),(0,o._)("div",Ut,[i.status?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("button",{key:0,type:"button",class:"btn btn-outline-danger",onClick:e[8]||(e[8]=(...t)=>n.deleteProfile&&n.deleteProfile(...t))}," 刪除員工資料 ")),At,(0,o._)("button",{type:"submit",class:"btn btn-primary",disabled:!s.valid}," Save changes ",8,It)])])),_:1},8,["onSubmit"])])])],512)}var Nt={data(){return{modal:"",status:!1,tempData:{name:"",phone:"",idNumber:"",imageFront:"",imageBack:"",seniority:"",hourlyRate:0,position:"工人",_id:""}}},methods:{isPhone(t){const e=/^(09)[0-9]{8}$/;return!!e.test(t)||"需要正確的電話號碼"},addEditWorker(){this.$emitter.emit("loadingStatus",!0),this.tempData._id?(0,w.i3)(this.tempData).then((()=>{this.$emitter.emit("messageModal",{status:!0,message:"修改成功"}),this.$emitter.emit("getWorkerLsit"),this.$emitter.emit("loadingStatus",!1),this.hideModal()})).catch((t=>{console.log(t),this.$emitter.emit("loadingStatus",!1)})):(0,w.nx)(this.tempData).then((t=>{console.log(t),this.$emitter.emit("messageModal",{status:!0,message:"新增成功"}),this.$emitter.emit("getWorkerLsit"),this.$emitter.emit("loadingStatus",!1),this.hideModal()})).catch((t=>{console.log(t),this.$emitter.emit("loadingStatus",!1)}))},deleteProfile(){this.$emitter.emit("loadingStatus",!0);const t=prompt(`輸入該用戶ＩＤ：${this.tempData._id}`,"");t===this.tempData._id?(0,w.Mu)(this.tempData._id).then((t=>{console.log(t),this.$emitter.emit("messageModal",{status:!0,message:"刪除成功"}),this.$emitter.emit("loadingStatus",!1),this.$emitter.emit("getWorkerLsit"),this.hideModal()})).catch((t=>{console.log(t),this.$emitter.emit("messageModal",{status:!1,message:"刪除失敗"}),this.$emitter.emit("loadingStatus",!1)})):this.$emitter.emit("loadingStatus",!1)},showModal(){this.modal.show()},hideModal(){this.tempData={},this.modal.hide()}},mounted(){this.modal=new C.u_(this.$refs.AddEdit),this.$emitter.on("addEdit",(t=>{this.status=t.status,t.status||(this.tempData=JSON.parse(JSON.stringify(t.data))),this.showModal()}))}};const Rt=(0,V.Z)(Nt,[["render",Pt]]);var Ft=Rt,Bt=a(8769),qt={data(){return{workerList:[]}},components:{IdCardModal:O,WorkRecordModal:nt,AddEditModal:Ft},methods:{checkSignIn(){const t=(0,Bt.LP)();t?this.$http.defaults.headers.common.Authorization=`Bearer ${t}`:this.$router.push("/login")},getWorkers(){this.$emitter.emit("loadingStatus",!0),(0,w.mL)().then((t=>{this.workerList=t.data.data,this.$emitter.emit("loadingStatus",!1)})).catch((t=>{console.log(t),this.$emitter.emit("loadingStatus",!1)}))}},mounted(){this.getWorkers(),this.$emitter.on("getWorkerLsit",(()=>{this.getWorkers()}))},created(){this.checkSignIn()}};const Jt=(0,V.Z)(qt,[["render",f]]);var jt=Jt}}]);
//# sourceMappingURL=322.7e1a2886.js.map